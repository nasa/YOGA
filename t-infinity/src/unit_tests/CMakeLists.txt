cmake_minimum_required(VERSION 3.0 FATAL_ERROR)

set(UNIT_TEST_SRC
        AddHaloTests.cpp
        AddMissingFacesTests.cpp
        BetterDistanceCalculatorTests.cpp
        BoundaryNodesTests.cpp
        CartMeshTests.cpp
        CellCollapseTests.cpp
        CellTests.cpp
        CellSelectedMeshTests.cpp
        CellSelectorTests.cpp
        ColoringSyncPatternTests.cpp
        ConnectivityTests.cpp
        DemanglerTests.cpp
        DivineLoadBalancerTests.cpp
        EmerilTests.cpp
        ExplodeMeshTests.cpp
        EdgeNeighborsTests.cpp
        ExtrudeTests.cpp
        ExtractTests.cpp
        ExtrusionTests.cpp
        FaceNeighborTests.cpp
        FieldInterfaceTests.cpp
        FieldToolsTests.cpp
        FileStreamerTests.cpp
        FilteringTests.cpp
        GeometryTests.cpp
        GlobalPairIdsTests.cpp
        GradientTests.cpp
        GridCombinerTests.cpp
        HangingEdgeRemesherTests.cpp
        InternalFaceRemoverTests.cpp
        LayerInsertionTests.cpp
        LineSamplingTests.cpp
        ManifoldTests.cpp
        MapBcFileCombinerTests.cpp
        MapBetweenMeshesTests.cpp
        MeshBuilderTests.cpp
        MeshConnectivityTests.cpp
        MeshDefTests.cpp
        MeshFixerTests.cpp
        MeshGathererTests.cpp
        MeshHelpersTests.cpp
        MeshInterfaceBaseClassTests.cpp
        MeshMechanicsTests.cpp
        MeshMoverTests.cpp
        MeshQueryTests.cpp
        MeshQualityTests.cpp
        MeshSanityCheckerTests.cpp
        MeshShuffleTests.cpp
        MeshSkinnerTests.cpp
        MetricAugmentationTests.cpp
        MetricLimiterTests.cpp
        MetricManipulatorTests.cpp
        MeshMemoryConsumptionTests.cpp
        MirroringTests.cpp
        MockMeshes.h
        MockFields.h
        MDVectorTests.cpp
        MotionMatrixParserTests.cpp
        NodeToNodeTests.cpp
        OwnedFirstNodeOrderingTests.cpp
        ParallelUgridExporterTests.cpp
        PartitionConnectivityTests.cpp
        PeriodicTests.cpp
        PipelineTests.cpp
        PluginLoaderTests.cpp
        PluginLocatorTests.cpp
        PointCloudInterpolatorTests.cpp
        P2ElevationTests.cpp
        QuiltTagsTests.cpp
        ReorderedMeshTests.cpp
        ReverseCutthillMckeeTests.cpp
        RecipeGeneratorTests.cpp
        RayAgentTests.cpp
        ReorderedMeshTests.cpp
        ReverseCutthillMckeeTests.cpp
        RCB4DWrapperTests.cpp
        SliverCellDetectionTests.cpp
        IsoSamplingTests.cpp
        ScatterPlotterTests.cpp
        SnapTests.cpp
        SolutionInterfaceTests.cpp
        SphereNormalTests.cpp
        StructuredMeshPlotTests.cpp
        StructuredBlockConnectivityTests.cpp
        StructuredMeshGradientsTests.cpp
        StructuredToUnstructuredMeshAdapterTests.cpp
        StructuredGridLoadBalancingTests.cpp
        StructuredMeshSequencingTests.cpp
        StructuredBCRegionTests.cpp
        StructuredBlockPlaneSyncerTests.cpp
        StructuredMeshGlobalIdsTests.cpp
        StructuredMeshSyncerTests.cpp
        StructuredMeshShuffleTests.cpp
        StructuredMeshPartitioningTests.cpp
        SurfaceEdgeNeighborsTests.cpp
        SurfacePlaneSamplingTests.cpp
        SurfaceMeshReconstructionTests.cpp
        SurfaceMeshTests.cpp
        StructuredMeshHelpersTests.cpp
        StitchMeshTests.cpp
        TinfMeshAppenderTests.cpp
        TinfMeshTests.cpp
        TetgenWriterTests.cpp
        TopologicalRotationTests.cpp
        VectorFieldAdapterTests.cpp
        WallNormalDerivativeTests.cpp
        SubdomainTests.cpp
        FieldShuffleTests.cpp
        TwodWrapperTests.cpp
        FluidSolverTests.cpp
        StructuredMeshFilterTests.cpp
        VizFromDictionaryTests.cpp
        WiggleTests.cpp
        )

add_catch_unit_test(infinity_unit_tests ${UNIT_TEST_SRC})
add_mpi_test(infinity_unit_tests 2)
mpi_test_requires_grids(infinity_unit_tests 1)
mpi_test_requires_grids(infinity_unit_tests 2)

target_include_directories(infinity_unit_tests PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../src>
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../interfaces>
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../src/pybind11/include>
        ${PYTHON_INCLUDE_DIRS}
    )
target_link_libraries(infinity_unit_tests PUBLIC
        parfait::parfait
        infinity::infinity
        MessagePasser::MessagePasser
        ${PYTHON_LIBRARIES}
        )
target_compile_definitions(infinity_unit_tests PRIVATE -DGRIDS_DIR="${CMAKE_CURRENT_SOURCE_DIR}/../../../grids/")

